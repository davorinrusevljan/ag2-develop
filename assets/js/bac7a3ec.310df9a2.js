"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[84526],{7515:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>u,frontMatter:()=>s,metadata:()=>r,toc:()=>l});var o=n(74848),a=n(28453);const s={custom_edit_url:"https://github.com/ag2ai/ag2/edit/main/notebook/agentchat_structured_outputs.ipynb",description:"OpenAI offers a functionality for defining a structure of the messages generated by LLMs, AutoGen enables this functionality by propagating response_format passed to your agents to the underlying client.",source_notebook:"/notebook/agentchat_structured_outputs.ipynb",tags:["structured output"],title:"Structured output"},i="Structured output",r={id:"notebooks/agentchat_structured_outputs",title:"Structured output",description:"OpenAI offers a functionality for defining a structure of the messages generated by LLMs, AutoGen enables this functionality by propagating response_format passed to your agents to the underlying client.",source:"@site/docs/notebooks/agentchat_structured_outputs.mdx",sourceDirName:"notebooks",slug:"/notebooks/agentchat_structured_outputs",permalink:"/ag2/docs/notebooks/agentchat_structured_outputs",draft:!1,unlisted:!1,editUrl:"https://github.com/ag2ai/ag2/edit/main/notebook/agentchat_structured_outputs.ipynb",tags:[{label:"structured output",permalink:"/ag2/docs/tags/structured-output"}],version:"current",frontMatter:{custom_edit_url:"https://github.com/ag2ai/ag2/edit/main/notebook/agentchat_structured_outputs.ipynb",description:"OpenAI offers a functionality for defining a structure of the messages generated by LLMs, AutoGen enables this functionality by propagating response_format passed to your agents to the underlying client.",source_notebook:"/notebook/agentchat_structured_outputs.ipynb",tags:["structured output"],title:"Structured output"},sidebar:"notebooksSidebar",previous:{title:"Interactive LLM Agent Dealing with Data Stream",permalink:"/ag2/docs/notebooks/agentchat_stream"},next:{title:"WebSurferAgent",permalink:"/ag2/docs/notebooks/agentchat_surfer"}},c={},l=[{value:"Set your API Endpoint",id:"set-your-api-endpoint",level:2},{value:"Example: math reasoning",id:"example-math-reasoning",level:2},{value:"Define the reasoning model",id:"define-the-reasoning-model",level:3},{value:"Define chat actors",id:"define-chat-actors",level:3},{value:"Start the chat",id:"start-the-chat",level:3}];function h(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.h1,{id:"structured-output",children:"Structured output"}),"\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.a,{href:"https://colab.research.google.com/github/ag2ai/ag2/blob/main/notebook/agentchat_structured_outputs.ipynb",children:(0,o.jsx)(t.img,{src:"https://colab.research.google.com/assets/colab-badge.svg",alt:"Open In Colab"})}),"\n",(0,o.jsx)(t.a,{href:"https://github.com/ag2ai/ag2/blob/main/notebook/agentchat_structured_outputs.ipynb",children:(0,o.jsx)(t.img,{src:"https://img.shields.io/badge/Open%20on%20GitHub-grey?logo=github",alt:"Open on GitHub"})})]}),"\n",(0,o.jsxs)(t.p,{children:["OpenAI offers a functionality for defining a structure of the messages\ngenerated by LLMs, AutoGen enables this functionality by propagating\n",(0,o.jsx)(t.code,{children:"response_format"})," passed to your agents to the underlying client."]}),"\n",(0,o.jsxs)(t.p,{children:["For more info on structured output, please check\n",(0,o.jsx)(t.a,{href:"https://platform.openai.com/docs/guides/structured-outputs",children:"here"})]}),"\n",(0,o.jsxs)(t.admonition,{title:"Requirements",type:"info",children:[(0,o.jsxs)(t.p,{children:["Install ",(0,o.jsx)(t.code,{children:"pyautogen"}),":"]}),(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"pip install pyautogen\n"})}),(0,o.jsxs)(t.p,{children:["For more information, please refer to the ",(0,o.jsx)(t.a,{href:"/docs/installation/",children:"installation guide"}),"."]})]}),"\n",(0,o.jsx)(t.h2,{id:"set-your-api-endpoint",children:"Set your API Endpoint"}),"\n",(0,o.jsxs)(t.p,{children:["The\n",(0,o.jsx)(t.a,{href:"https://ag2ai.github.io/ag2/docs/reference/oai/openai_utils#config_list_from_json",children:(0,o.jsx)(t.code,{children:"config_list_from_json"})}),"\nfunction loads a list of configurations from an environment variable or\na json file."]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-python",children:'import autogen\n\nconfig_list = autogen.config_list_from_json(\n    "OAI_CONFIG_LIST",\n    filter_dict={\n        "model": ["gpt-4o", "gpt-4o-mini"],\n    },\n)\n'})}),"\n",(0,o.jsx)(t.admonition,{type:"tip",children:(0,o.jsxs)(t.p,{children:["Learn more about configuring LLMs for agents ",(0,o.jsx)(t.a,{href:"/docs/topics/llm_configuration",children:"here"}),"."]})}),"\n",(0,o.jsx)(t.h2,{id:"example-math-reasoning",children:"Example: math reasoning"}),"\n",(0,o.jsx)(t.p,{children:"Using structured output, we can enforce chain-of-thought reasoning in\nthe model to output an answer in a structured, step-by-step way"}),"\n",(0,o.jsx)(t.h3,{id:"define-the-reasoning-model",children:"Define the reasoning model"}),"\n",(0,o.jsx)(t.p,{children:"First we will define the math reasoning model. This model will\nindirectly force the LLM to solve the posed math problems iteratively\ntrough math reasoning steps."}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-python",children:"from pydantic import BaseModel\n\n\nclass Step(BaseModel):\n    explanation: str\n    output: str\n\nclass MathReasoning(BaseModel):\n    steps: list[Step]\n    final_answer: str\n"})}),"\n",(0,o.jsx)(t.h3,{id:"define-chat-actors",children:"Define chat actors"}),"\n",(0,o.jsxs)(t.p,{children:["Now we can define the agents that will solve the posed math problem. We\nwill keep this example simple; we will use a ",(0,o.jsx)(t.code,{children:"UserProxyAgent"})," to input\nthe math problem and an ",(0,o.jsx)(t.code,{children:"AssistantAgent"})," to solve it."]}),"\n",(0,o.jsxs)(t.p,{children:["The ",(0,o.jsx)(t.code,{children:"AssistantAgent"})," will be constrained to solving the math problem\nstep-by-step by using the ",(0,o.jsx)(t.code,{children:"MathReasoning"})," response format we defined\nabove."]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-python",children:'llm_config = {"config_list": config_list, "cache_seed": 42}\n\nuser_proxy = autogen.UserProxyAgent(\n    name="User_proxy",\n    system_message="A human admin.",\n    human_input_mode="NEVER",\n)\n\nassistant = autogen.AssistantAgent(\n    name="Math_solver",\n    llm_config=llm_config,\n    response_format=MathReasoning,\n)\n'})}),"\n",(0,o.jsx)(t.h3,{id:"start-the-chat",children:"Start the chat"}),"\n",(0,o.jsxs)(t.p,{children:["Let\u2019s now start the chat and prompt the assistant to solve a simple\nequation. The assistant agent should return a response solving the\nequation using a step-by-step ",(0,o.jsx)(t.code,{children:"MathReasoning"})," model."]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-python",children:'user_proxy.initiate_chat(assistant, message="how can I solve 8x + 7 = -23", max_turns=1, summary_method="last_msg")\n'})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-text",children:'User_proxy (to Math_solver):\n\nhow can I solve 8x + 7 = -23\n\n--------------------------------------------------------------------------------\n[autogen.oai.client: 11-29 23:42:48] {921} INFO - Failed to cache response: Can\'t pickle <class \'openai.types.chat.parsed_chat_completion.ParsedChatCompletion[MathReasoning]\'>: attribute lookup ParsedChatCompletion[MathReasoning] on openai.types.chat.parsed_chat_completion failed\nMath_solver (to User_proxy):\n\n{"steps":[{"explanation":"We need to isolate the variable x on one side of the equation. We start by getting rid of the constant on the left side of the equation. In this case, the constant is 7, which is added to 8x. We can subtract 7 from both sides of the equation to eliminate this constant.","output":"8x + 7 - 7 = -23 - 7\\n8x = -30"},{"explanation":"Now that we have 8x = -30, we want to solve for x. To do this, we need to divide both sides of the equation by 8, which is the coefficient of x.","output":"8x / 8 = -30 / 8\\nx = -30 / 8"},{"explanation":"Next, we simplify the fraction -30 / 8. Both the numerator and the denominator can be divided by 2 to simplify the fraction.","output":"x = -30 / 8 = -15 / 4"},{"explanation":"The simplified fraction -15 / 4 can also be written as a decimal if needed.","output":"x = -15 / 4 = -3.75"}],"final_answer":"x = -15/4 or x = -3.75"}\n\n--------------------------------------------------------------------------------\n'})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-text",children:'ChatResult(chat_id=None, chat_history=[{\'content\': \'how can I solve 8x + 7 = -23\', \'role\': \'assistant\', \'name\': \'User_proxy\'}, {\'content\': \'{"steps":[{"explanation":"We need to isolate the variable x on one side of the equation. We start by getting rid of the constant on the left side of the equation. In this case, the constant is 7, which is added to 8x. We can subtract 7 from both sides of the equation to eliminate this constant.","output":"8x + 7 - 7 = -23 - 7\\\\n8x = -30"},{"explanation":"Now that we have 8x = -30, we want to solve for x. To do this, we need to divide both sides of the equation by 8, which is the coefficient of x.","output":"8x / 8 = -30 / 8\\\\nx = -30 / 8"},{"explanation":"Next, we simplify the fraction -30 / 8. Both the numerator and the denominator can be divided by 2 to simplify the fraction.","output":"x = -30 / 8 = -15 / 4"},{"explanation":"The simplified fraction -15 / 4 can also be written as a decimal if needed.","output":"x = -15 / 4 = -3.75"}],"final_answer":"x = -15/4 or x = -3.75"}\', \'tool_calls\': [], \'role\': \'user\', \'name\': \'Math_solver\'}], summary=\'{"steps":[{"explanation":"We need to isolate the variable x on one side of the equation. We start by getting rid of the constant on the left side of the equation. In this case, the constant is 7, which is added to 8x. We can subtract 7 from both sides of the equation to eliminate this constant.","output":"8x + 7 - 7 = -23 - 7\\\\n8x = -30"},{"explanation":"Now that we have 8x = -30, we want to solve for x. To do this, we need to divide both sides of the equation by 8, which is the coefficient of x.","output":"8x / 8 = -30 / 8\\\\nx = -30 / 8"},{"explanation":"Next, we simplify the fraction -30 / 8. Both the numerator and the denominator can be divided by 2 to simplify the fraction.","output":"x = -30 / 8 = -15 / 4"},{"explanation":"The simplified fraction -15 / 4 can also be written as a decimal if needed.","output":"x = -15 / 4 = -3.75"}],"final_answer":"x = -15/4 or x = -3.75"}\', cost={\'usage_including_cached_inference\': {\'total_cost\': 0.004085, \'gpt-4o-2024-08-06\': {\'cost\': 0.004085, \'prompt_tokens\': 582, \'completion_tokens\': 263, \'total_tokens\': 845}}, \'usage_excluding_cached_inference\': {\'total_cost\': 0.004085, \'gpt-4o-2024-08-06\': {\'cost\': 0.004085, \'prompt_tokens\': 582, \'completion_tokens\': 263, \'total_tokens\': 845}}}, human_input=[])\n'})})]})}function u(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(h,{...e})}):h(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>r});var o=n(96540);const a={},s=o.createContext(a);function i(e){const t=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),o.createElement(s.Provider,{value:t},e.children)}}}]);